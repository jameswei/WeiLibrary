//以下是一段使用连接池pool的mongodb的代码，用户访问就会相应一条mongodb数据库里的内容
module.exports.rrestconfig = {
	listenPort:3000,
	//mongodb 配置
	isMongodb:true, //是否开启mongodb支持，注意：如果使用数据库存储session，这里必须开启
	MongodbIp:'127.0.0.1', //mongodb地址
	MongodbRC:false,//如果是false表示不使用mongodb的副本集，否则为字符串，表示副本集的名称
	MongodbRChost:[],//表示mongodb副本集的ip:port数组。
	MongodbPort:27017, //mongodb端口
	MongodbConnectString:false, //是否使用字符串连接，日入nae的连接方法，这个优先级高于地址+端口
	MongodbConnectTimeout:1000*30,//连接超时
	MongodbMaxConnect:50,//连接池连接数
	MongodbDefaultDbName:'rrest',//默认使用的数据库名
	poolLogger:false,//是否记录连接池的日志，建议关闭
	}
var http = require('http'),
    rrest = require('rrestjs'),
   server = http.createServer(function (req, res){
		rrest.mongo(function(err, db, release){
			db.collection("mongotest", function(err, collection){
				if(err) return mongo_err(err, release);
				collection.findOne({id: 1}, function(err, doc){
					if(err) return mongo_err(err, release);
					res.sendjson(doc);
					release();
				});
			});
		});
	}).listen(rrest.config.listenPort);

var mongo_err = function(err, release){
	console.log(err);
	return release();
};

rrest.mongo(function(err, db, release){//Caution release!
	if(err) return mongo_err(err, release);
	db.collection('mongotest', function(err, collection){
		if(err) return mongo_err()
		collection.save({id:1, name:'Mongodb rrestjs test!'}, {'safe':true}, function(err,r){
			if(err) return mongo_err(err, release);	
			release();
		});
	});
});